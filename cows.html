<!DOCTYPE html>
<html>
<head>
  <title>Cow Records</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body{
      margin:0;
      font-family:Segoe UI,Arial;
      background:#0b0f14;
      color:white;
    }

    /* ===== SIDEBAR ===== */
    .sidebar{
      position:fixed;
      left:0;
      top:0;
      height:100vh;
      width:220px;
      background:rgba(20,20,20,0.9);
      backdrop-filter:blur(14px);
      padding:20px;
    }

    .sidebar h2{
      color:#f9c74f;
      text-align:center;
      margin-bottom:20px;
    }

    .sidebar a,
    .sidebar button{
      display:block;
      margin:8px 0;
      padding:12px;
      border-radius:10px;
      text-decoration:none;
      background:rgba(255,255,255,0.06);
      color:white;
      font-weight:600;
      border:none;
      cursor:pointer;
    }

    .sidebar a.active{
      background:linear-gradient(135deg,#90dbf4,#4cc9f0);
      color:black;
    }

    /* ===== CONTENT ===== */
    .content{
      margin-left:240px;
      padding:20px;
    }

    header{
      text-align:center;
      font-size:24px;
      color:#f9c74f;
      margin-bottom:20px;
    }

    .box{
      background:rgba(255,255,255,0.08);
      backdrop-filter:blur(12px);
      border-radius:18px;
      padding:20px;
      margin-bottom:20px;
    }

    input, select, button{
      width:100%;
      padding:12px;
      margin-top:10px;
      border:none;
      border-radius:10px;
      background:#111;
      color:white;
    }

    button{
      background:linear-gradient(135deg,#f9c74f,#f9844a);
      font-weight:bold;
      cursor:pointer;
    }

    .record{
      background:rgba(255,255,255,0.06);
      padding:15px;
      border-radius:14px;
      margin-bottom:12px;
    }

    .status{
      color:#4cc9f0;
      font-weight:bold;
    }

    /* ===== MOBILE ===== */
    .bottom-nav{display:none;}
    @media(max-width:768px){
      .sidebar{display:none;}
      .content{margin-left:0;padding-bottom:90px;}
      .bottom-nav{
        display:flex;
        position:fixed;
        bottom:0;
        left:0;
        width:100%;
        background:rgba(20,20,20,0.95);
        justify-content:space-around;
        padding:12px 0;
      }
      .bottom-nav a{
        font-size:22px;
        color:#f9c74f;
        text-decoration:none;
      }
      .bottom-nav a.active{color:#4cc9f0;}
    }
  </style>
</head>

<body>

<!-- ===== SIDEBAR ===== -->
<div class="sidebar">
  <h2>ğŸ„ PG Dairy</h2>
  <a href="dashboard.html" class="nav-link">ğŸ“Š Dashboard</a>
  <a href="cows.html" class="nav-link">ğŸ„ Cows</a>
  <a href="milk.html" class="nav-link">ğŸ¥› Milk</a>
  <a href="expenses.html" class="nav-link">ğŸ’¸ Expenses</a>
  <a href="finance.html" class="nav-link">ğŸ’° Finance</a>
  <a href="reports.html" class="nav-link">ğŸ“‘ Reports</a>
  <button onclick="logout()">ğŸšª Logout</button>
</div>

<!-- ===== MOBILE NAV ===== -->
<div class="bottom-nav">
  <a href="dashboard.html">ğŸ“Š</a>
  <a href="cows.html">ğŸ„</a>
  <a href="milk.html">ğŸ¥›</a>
  <a href="expenses.html">ğŸ’¸</a>
  <a href="finance.html">ğŸ’°</a>
  <a href="reports.html">ğŸ“‘</a>
</div>

<!-- ===== CONTENT ===== -->
<div class="content">

<header>ğŸ„ Cow Records</header>

<!-- ADD COW -->
<div class="box">
  <h3>Add Cow</h3>

  <input id="cowName" placeholder="Cow Name">
  <input id="cowId" placeholder="Cow ID">
  <input type="date" id="purchaseDate">
  <input type="number" id="capacity" placeholder="Milking Capacity (L/day)">

  <select id="status" onchange="handleStatusChange()">
    <option>Non Pregnant</option>
    <option>Pregnant</option>
    <option>Pregnant & Milking</option>
    <option>Milking</option>
    <option>Near to Delivery</option>
  </select>

  <!-- Pregnancy Fields -->
  <div id="inseminationBox" style="display:none;">
    <input type="date" id="inseminationDate" onchange="calculateDelivery()">
  </div>

  <div id="deliveryBox" style="display:none;">
    <input type="date" id="deliveryDate" readonly>
  </div>

  <div id="monthsBox" style="display:none;">
    <input type="text" id="pregMonths" readonly placeholder="Pregnancy Months">
  </div>

  <button onclick="saveCow()">Save Cow</button>
</div>

<!-- LIST -->
<div id="cowList"></div>

</div>

<!-- ===== ACTIVE PAGE ===== -->
<script>
  const links=document.querySelectorAll(".nav-link,.bottom-nav a");
  const current=location.pathname.split("/").pop();
  links.forEach(l=>{
    if(l.getAttribute("href")===current)l.classList.add("active");
  });
</script>

<!-- ===== FIREBASE + LOGIC ===== -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from
    "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signOut } from
    "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  const firebaseConfig={
    apiKey:"AIzaSyC4lH4ViCEhQbvNt6nLXmfR-AhAa1-b6Bk",
    authDomain:"pgdairy-63765.firebaseapp.com",
    projectId:"pgdairy-63765",
    appId:"1:460696117464:web:410ce4a62e899d8567f7ad"
  };

  const app=initializeApp(firebaseConfig);
  const db=getFirestore(app);
  const auth=getAuth(app);

  onAuthStateChanged(auth,u=>{
    if(!u)location.href="login.html";
  });

  window.handleStatusChange=function(){
    const show = status.value==="Pregnant" || status.value==="Pregnant & Milking";
    inseminationBox.style.display = show ? "block":"none";
    deliveryBox.style.display = show ? "block":"none";
    monthsBox.style.display = show ? "block":"none";
    if(!show){
      inseminationDate.value="";
      deliveryDate.value="";
      pregMonths.value="";
    }
  };

  window.calculateDelivery=function(){
    if(!inseminationDate.value) return;
    const d=new Date(inseminationDate.value);
    d.setDate(d.getDate()+283);
    deliveryDate.value=d.toISOString().split("T")[0];
    updatePregnancyMonths();
  };

  function updatePregnancyMonths(){
    if(!inseminationDate.value) return;
    const start=new Date(inseminationDate.value);
    const today=new Date();
    let months=(today.getFullYear()-start.getFullYear())*12+(today.getMonth()-start.getMonth());
    if(months<0)months=0;
    if(months>9)months=9;
    pregMonths.value=months+" months";
  }

  setInterval(updatePregnancyMonths,86400000);

  window.saveCow=async()=>{
    await addDoc(collection(db,"cows"),{
      cowName:cowName.value,
      cowId:cowId.value,
      purchaseDate:purchaseDate.value,
      inseminationDate:inseminationDate.value||null,
      expectedDelivery:deliveryDate.value||null,
      pregnancyMonths:pregMonths.value||null,
      capacity:Number(capacity.value),
      status:status.value,
      createdAt:new Date()
    });
    loadCows();
  };

  async function loadCows(){
    cowList.innerHTML="";
    const snap=await getDocs(collection(db,"cows"));
    snap.forEach(d=>{
      const c=d.data();
      cowList.innerHTML+=`
        <div class="record">
          <b>${c.cowName}</b> (${c.cowId})<br>
          ğŸ—“ Purchase: ${c.purchaseDate||"-"}<br>
          ğŸ’‰ Insemination: ${c.inseminationDate||"-"}<br>
          ğŸ¼ Expected Delivery: ${c.expectedDelivery||"-"}<br>
          ğŸ¤° Pregnancy: ${c.pregnancyMonths||"-"}<br>
          ğŸ¥› Capacity: ${c.capacity} L/day<br>
          <span class="status">Status: ${c.status}</span><br><br>
          <button onclick="deleteCow('${d.id}')">Delete</button>
        </div>`;
    });
  }

  window.deleteCow=async(id)=>{
    await deleteDoc(doc(db,"cows",id));
    loadCows();
  };

  loadCows();

  window.logout=()=>{
    signOut(auth).then(()=>location.href="login.html");
  };
</script>

</body>
</html>
