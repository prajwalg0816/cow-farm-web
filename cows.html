<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cow Records</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body{
      margin:0;
      font-family:Segoe UI, Arial, sans-serif;
      background:#0b0f14;
      color:white;
    }

    /* SIDEBAR */
    .sidebar{
      position:fixed;
      left:0;
      top:0;
      width:220px;
      height:100vh;
      background:rgba(20,20,20,0.95);
      padding:20px;
      box-shadow:5px 0 25px rgba(0,0,0,.6);
    }
    .sidebar a,.sidebar button{
      display:block;
      margin:10px 0;
      padding:12px;
      border-radius:10px;
      background:rgba(255,255,255,0.07);
      color:white;
      border:none;
      text-decoration:none;
      cursor:pointer;
      font-weight:600;
    }
    .sidebar a.active{
      background:#4cc9f0;
      color:black;
    }

    /* CONTENT */
    .content{
      margin-left:240px;
      padding:20px;
    }
    header{
      text-align:center;
      font-size:24px;
      color:#f9c74f;
      margin-bottom:20px;
    }

    .top-buttons{
      display:flex;
      gap:10px;
      margin-bottom:20px;
    }
    .top-buttons button{
      flex:1;
      padding:12px;
      border:none;
      border-radius:12px;
      background:linear-gradient(135deg,#f9c74f,#f9844a);
      font-weight:bold;
      cursor:pointer;
    }

    .box{
      background:rgba(255,255,255,0.08);
      backdrop-filter:blur(10px);
      padding:20px;
      border-radius:16px;
      margin-bottom:20px;
    }

    input,select,button{
      width:100%;
      padding:12px;
      margin-top:10px;
      border:none;
      border-radius:10px;
      background:#111;
      color:white;
      font-size:15px;
    }

    .record{
      background:rgba(255,255,255,0.06);
      padding:15px;
      border-radius:14px;
      margin-bottom:12px;
    }

    .editBtn{
      background:#4cc9f0;
      color:black;
      margin-top:8px;
    }
    .delBtn{
      background:#f94144;
      margin-top:8px;
    }

    @media(max-width:768px){
      .sidebar{display:none;}
      .content{margin-left:0;}
    }
  </style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <a href="dashboard.html">Dashboard</a>
  <a href="cows.html" class="active">Cows</a>
  <a href="milk.html">Milk</a>
  <a href="expenses.html">Expenses</a>
  <a href="finance.html">Finance</a>
  <a href="reports.html">Reports</a>
  <button id="logoutBtn">Logout</button>
</div>

<div class="content">
<header>üêÑ Cow Management</header>

<div class="top-buttons">
  <button id="addBtn">‚ûï Add Cow</button>
  <button id="viewBtn">üëÅ View Cows</button>
</div>

<!-- ADD COW -->
<div id="addSection" class="box" style="display:none;">
  <h3>Add Cow</h3>

  <input id="cowName" placeholder="Cow Name">
  <input id="cowId" placeholder="Cow ID">
  <input type="date" id="purchaseDate">
  <input type="number" id="capacity" placeholder="Milking Capacity (L/day)">

  <select id="status">
    <option value="Non Pregnant">Non Pregnant</option>
    <option value="Pregnant">Pregnant</option>
    <option value="Pregnant & Milking">Pregnant & Milking</option>
    <option value="Milking">Milking</option>
    <option value="Near to Delivery">Near to Delivery</option>
  </select>

  <div id="inseminationBox" style="display:none;">
    <input type="date" id="inseminationDate">
  </div>

  <div id="deliveryBox" style="display:none;">
    <input type="date" id="deliveryDate" readonly>
  </div>

  <div id="monthsBox" style="display:none;">
    <input id="pregMonths" readonly placeholder="Pregnancy Months">
  </div>

  <button id="saveBtn">Save Cow</button>
</div>

<!-- VIEW COWS -->
<div id="viewSection" class="box" style="display:none;">
  <h3>All Cows</h3>
  <div id="cowList"></div>
</div>

</div>

<!-- FIREBASE + LOGIC -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

/* FIREBASE INIT */
const app = initializeApp({
  apiKey:"AIzaSyC4lH4ViCEhQbvNt6nLXmfR-AhAa1-b6Bk",
  authDomain:"pgdairy-63765.firebaseapp.com",
  projectId:"pgdairy-63765"
});
const db = getFirestore(app);
const auth = getAuth(app);

/* DOM */
const cowName = document.getElementById("cowName");
const cowId = document.getElementById("cowId");
const purchaseDate = document.getElementById("purchaseDate");
const capacity = document.getElementById("capacity");
const statusEl = document.getElementById("status");
const inseminationDate = document.getElementById("inseminationDate");
const deliveryDate = document.getElementById("deliveryDate");
const pregMonths = document.getElementById("pregMonths");
const inseminationBox = document.getElementById("inseminationBox");
const deliveryBox = document.getElementById("deliveryBox");
const monthsBox = document.getElementById("monthsBox");
const cowList = document.getElementById("cowList");
const addSection = document.getElementById("addSection");
const viewSection = document.getElementById("viewSection");

/* AUTH CHECK */
onAuthStateChanged(auth,u=>{
  if(!u) location.href="login.html";
});

/* NAV */
document.getElementById("addBtn").onclick=()=>{
  addSection.style.display="block";
  viewSection.style.display="none";
};
document.getElementById("viewBtn").onclick=()=>{
  addSection.style.display="none";
  viewSection.style.display="block";
  loadCows();
};

/* STATUS LOGIC */
statusEl.onchange=()=>{
  const show=statusEl.value.includes("Pregnant");
  inseminationBox.style.display=show?"block":"none";
  deliveryBox.style.display=show?"block":"none";
  monthsBox.style.display=show?"block":"none";
};

/* SAVE */
document.getElementById("saveBtn").onclick=async()=>{
  const data={
    cowName:cowName.value,
    cowId:cowId.value,
    purchaseDate:purchaseDate.value||null,
    inseminationDate:inseminationDate.value||null,
    expectedDelivery:deliveryDate.value||null,
    pregnancyMonths:pregMonths.value||null,
    capacity:Number(capacity.value)||0,
    status:statusEl.value,
    createdAt:new Date()
  };
  await addDoc(collection(db,"cows"),data);
  alert("‚úÖ Cow saved successfully");
};

/* LOAD */
async function loadCows(){
  cowList.innerHTML="";
  const snap=await getDocs(collection(db,"cows"));
  snap.forEach(d=>{
    const c=d.data();
    cowList.innerHTML+=`
      <div class="record">
        <b>${c.cowName}</b> (${c.cowId})<br>
        Status: ${c.status}<br>
        Capacity: ${c.capacity} L/day
      </div>`;
  });
}

/* LOGOUT */
document.getElementById("logoutBtn").onclick=()=>{
  signOut(auth).then(()=>location.href="login.html");
};
</script>

</body>
</html>
